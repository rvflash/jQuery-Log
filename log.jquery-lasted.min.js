(function(b){var a={_available:true,_data:[],_fail:0,defaults:{type:"POST",url:"",interval:1000,maxFail:3},add:function(c){this._data.push(c)},listen:function(){window.onbeforeunload=function(){a.notify(true)};window.setInterval(function(){a.notify(false)},a.defaults.interval)},notify:function(d){if("undefined"==typeof d){d=false}d=(d||this._fail<this.defaults.maxFail);if(""!=this.defaults.url&&this._available&&0<this._data.length&&d){var c=this._data;this._data=[];this._available=false;b.ajax({url:this.defaults.url,type:this.defaults.type,data:{d:c}}).fail(function(){b.merge(a._data,c);a._fail++}).always(function(){a._available=true})}}};b.log=function(c){b.extend(true,a.defaults,c);a.listen()};b.logIt=function(c,d){if("undefined"==typeof d){d={}}a.add(b.extend(true,{},d,b(c).data()))}})(jQuery);